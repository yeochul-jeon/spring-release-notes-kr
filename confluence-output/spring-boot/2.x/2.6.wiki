h1. Spring Boot 2.6 릴리즈 노트

{quote}
출시일: 2021-11 | Java 최소 버전: 8 | [공식 릴리즈 노트|https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.6-Release-Notes]
{quote}

h2. 개요

Spring Boot 2.6은 *Spring Framework 5.3* 기반으로, *순환 참조(Circular Reference) 기본 금지*와
*PathPattern 기반 경로 매칭*이 가장 큰 변경점입니다.
이 외에도 SameSite 쿠키 지원, 리액티브 세션 설정, Actuator 개선 등 운영 편의성이 크게 향상되었습니다.

----

h2. 플랫폼 요구사항

|| 항목 || 요구 버전 ||
| *Java* | 8, 11 또는 17 |
| *Spring Framework* | [5.3|../../spring-framework/5.x/5.3.md] |
| *Servlet API* | 3.1+ ({{javax.servlet}}) |
| *Gradle* | 6.8+, 6.9 또는 7.x |
| *Maven* | 3.5+ |
| *Tomcat* | 9.0 |
| *Jetty* | 9.4 또는 10.0 |
| *Undertow* | 2.2 |

----

h2. 주요 변경사항

h3. 1. 순환 참조(Circular Reference) 기본 금지

순환 참조란 빈(Bean) A가 빈 B를 의존하고, 빈 B가 다시 빈 A를 의존하는 상황을 말합니다.
이전까지는 Spring이 이를 자동으로 해결해주었지만, 2.6부터는 *기본적으로 금지*됩니다.

{code:language=java}
// 순환 참조 예시 - 2.6부터 애플리케이션 시작 시 오류 발생
@Service
public class ServiceA {
    private final ServiceB serviceB;
    public ServiceA(ServiceB serviceB) { this.serviceB = serviceB; }
}

@Service
public class ServiceB {
    private final ServiceA serviceA;
    public ServiceB(ServiceA serviceA) { this.serviceA = serviceA; }
}
{code}

순환 참조가 반드시 필요한 경우, 아래 설정으로 허용할 수 있습니다:

{code:language=properties}
# application.properties
spring.main.allow-circular-references=true
{code}

{quote}
*권장:* 순환 참조를 허용하기보다 설계를 개선하여 의존성 방향을 정리하는 것이 좋습니다.
{quote}

h3. 2. PathPattern 기반 경로 매칭 (기본값 변경)

Spring MVC의 요청 경로 매칭 전략이 기존 {{AntPathMatcher}}에서 {{PathPatternParser}}로 변경되었습니다.
{{PathPatternParser}}는 성능이 더 뛰어나지만, 일부 호환성 문제가 있습니다.

{code:language=properties}
# 기존 방식으로 되돌리려면
spring.mvc.pathmatch.matching-strategy=ant-path-matcher
{code}

{quote}
*주의:* Spring Security의 {{mvcMatchers()}}를 사용하는 경우, 경로 앞에 반드시 {{/}}(슬래시)를 붙여야 합니다.
{quote}

{code:language=java}
// 2.6 이전에는 동작했지만, 2.6부터 슬래시 필수
http.authorizeRequests()
    .mvcMatchers("/api/**").authenticated()  // 슬래시 필수
    .anyRequest().permitAll();
{code}

h3. 3. Spring Boot 2.4에서 Deprecated된 API 제거

Spring Boot 2.4에서 폐기(deprecated) 표시된 클래스, 메서드, 프로퍼티가 이 버전에서 *완전히 제거*되었습니다.

h3. 4. Elasticsearch 프로퍼티 통합

기존에 분산되어 있던 Elasticsearch 관련 프로퍼티가 {{spring.elasticsearch}} 아래로 통합되었습니다:

{code:language=properties}
# 이전 (2.5)
spring.elasticsearch.rest.uris=http://localhost:9200
spring.data.elasticsearch.client.reactive.endpoints=localhost:9200

# 이후 (2.6) - 통합된 프로퍼티
spring.elasticsearch.uris=http://localhost:9200
{code}

h3. 5. Kafka 3.0 멱등성(Idempotence) 기본 활성화

Kafka 3.0에서 프로듀서의 멱등성이 기본으로 활성화됩니다. 클러스터 권한이 부족하면
{{ClusterAuthorizationException}}이 발생할 수 있습니다.

{code:language=properties}
# 문제 발생 시 비활성화
spring.kafka.producer.properties.enable.idempotence=false
{code}

h3. 6. WebProperties로 리소스 설정 주입 변경

{{Resources}} 클래스 직접 주입이 더 이상 동작하지 않으며, {{WebProperties}}를 통해 리소스 설정에 접근해야 합니다.

----

h2. 새로운 기능

h3. SameSite 쿠키 속성 지원

SameSite는 쿠키의 Cross-Site(교차 사이트) 전송을 제어하는 보안 속성입니다.
서블릿 애플리케이션에서 세션 쿠키의 SameSite 속성을 설정할 수 있습니다:

{code:language=properties}
# Strict: 같은 사이트에서만 쿠키 전송
server.servlet.session.cookie.same-site=strict

# Lax(기본값): GET 요청에서는 Cross-Site 허용
server.servlet.session.cookie.same-site=lax

# None: 모든 Cross-Site에서 허용 (Secure 필수)
server.servlet.session.cookie.same-site=none
{code}

h3. 리액티브 서버 세션 프로퍼티

리액티브(WebFlux) 애플리케이션에서도 세션 관련 설정이 {{server.reactive.session}} 하위에 추가되어,
서블릿 방식과 동일한 수준의 세션 제어가 가능해졌습니다.

h3. Actuator {{/info}} 엔드포인트에 Java 런타임 정보

{code:language=properties}
# Java 런타임 정보 활성화
management.info.java.enabled=true
{code}

활성화하면 {{/actuator/info}}에서 JVM 버전, 벤더 등의 정보를 확인할 수 있습니다.

h3. 커스텀 Sanitization(민감 정보 마스킹)

{{SanitizingFunction}} 빈을 등록하면 Actuator 엔드포인트에서 노출되는 프로퍼티 값의 마스킹 규칙을 직접 정의할 수 있습니다.

h3. Docker 이미지 빌드 개선

* 추가 이미지 태그 지정 가능
* 빌드 시 네트워크 설정 지원
* 캐시 볼륨 커스터마이징 지원

h3. record 클래스로 {{@ConfigurationProperties}} 지원

Java 16+의 {{record}}를 {{@ConfigurationProperties}}에 사용할 수 있습니다:

{code:language=java}
// record로 불변(immutable) 설정 클래스 정의
@ConfigurationProperties(prefix = "app")
public record AppProperties(
    String name,       // app.name
    int maxRetries     // app.max-retries
) {}
{code}

----

h2. 개선사항

* **Spring Data Envers 자동 설정** 추가
* **Redis 커넥션 풀**: `commons-pool2`가 클래스패스에 있으면 자동으로 커넥션 풀링 활성화
* **Kafka SSL**: PEM 형식의 인증서를 직접 사용 가능
* **Log4j2 복합 설정**: 여러 설정 파일을 조합하여 사용 가능
* **`@WebServiceServerTest`**: Web Service 엔드포인트 슬라이스 테스트 어노테이션 추가
* **MessageSource 기반 Bean Validation**: Bean Validation 메시지를 `MessageSource`에서 자동 조회
* **WebTestClient로 Spring MVC 테스트**: `MockMvc` 외에 `WebTestClient`를 MVC 테스트에서도 사용 가능
* **Jetty 커넥션/SSL 메트릭**, **디스크 공간 메트릭** 등 메트릭 자동 설정 확대
* **Dynatrace v2 API 메트릭 내보내기** 지원

----

h2. Deprecated 및 제거 항목

h3. Deprecated (향후 제거 예정)

|| 항목 || 대체 방안 ||
| {{AbstractDataSourceInitializer}} | {{DataSourceScriptDatabaseInitializer}} 사용 |
| {{SpringPhysicalNamingStrategy}} | Hibernate의 {{CamelCaseToUnderscoresNamingStrategy}} 사용 |
| {{Duration}} 파라미터를 받지 않는 일부 메서드 | {{Duration}}을 받는 새 메서드로 교체 |

h3. 제거된 의존성 관리

* JBoss Transaction SPI
* Nimbus JOSE + JWT (OAuth2 OIDC SDK)
* HAL Browser (HAL Explorer로 대체)

----

h2. 호환성

{code:language=text|title=mermaid|collapse=true}
graph LR
    SB26["Spring Boot 2.6"]

    subgraph "핵심"
        SF53["Spring Framework 5.3"]
        JAVA["Java 8 / 11 / 17"]
        SERVLET["Servlet 3.1+ (javax)"]
    end

    subgraph "서블릿 컨테이너"
        TOMCAT["Tomcat 9.0"]
        JETTY["Jetty 9.4 / 10.0"]
        UNDERTOW["Undertow 2.2"]
    end

    subgraph "주요 의존성"
        KAFKA["Kafka 3.0"]
        ES["Elasticsearch 7.x"]
        MM["Micrometer 1.8"]
    end

    SB26 --> SF53
    SB26 --> JAVA
    SB26 --> SERVLET
    SB26 --> TOMCAT
    SB26 --> JETTY
    SB26 --> UNDERTOW
    SB26 --> KAFKA
    SB26 --> ES
    SB26 --> MM

    style SB26 fill:#4CAF50,color:#fff
    style SF53 fill:#2196F3,color:#fff
{code}

----

h2. 참고 자료

* [Spring Boot 2.6 공식 릴리즈 노트](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.6-Release-Notes)
* [Spring Framework 5.3](../../spring-framework/5.x/5.3.md)
* [Spring Boot 2.7 릴리즈 노트](2.7.md) (다음 버전)
* [2.x → 3.x 마이그레이션 가이드](../../migration-guides/spring-boot-2to3.md)
