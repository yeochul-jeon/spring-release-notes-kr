h1. Spring Boot 3.1 릴리즈 노트

{quote}
출시일: 2023-05 | Java 최소 버전: 17 | [공식 릴리즈 노트|https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.1-Release-Notes]
{quote}

h2. 개요

Spring Boot 3.1은 *Docker Compose 통합*, *Testcontainers 개선*, *SSL Bundles*를 핵심으로 하는 기능 강화 버전입니다.
새로운 {{ConnectionDetails}} 추상화를 통해 외부 서비스 연결 정보를 일관되게 관리할 수 있게 되었고,
*Spring Authorization Server* 자동 설정이 추가되었습니다.
Spring Framework 6.0 기반이며, Hibernate 6.2와 Jackson 2.15 등 주요 의존성이 업그레이드되었습니다.

----

h2. 플랫폼 요구사항

|| 항목 || 요구 버전 ||
| *Java* | 17 이상 |
| *Spring Framework* | 6.0.9+ |
| *Spring Security* | 6.1 |
| *Hibernate* | 6.2 |
| *Gradle* | 7.5 이상 |
| *Maven* | 3.5 이상 |

----

h2. 주요 변경사항

h3. 1. Apache HttpClient 4 지원 제거

HttpClient 4의 의존성 관리가 제거되었습니다. *HttpClient 5*로 마이그레이션해야 합니다.

{code:language=xml|theme=Emacs}
<!-- 변경 후: HttpClient 5 사용 -->
<dependency>
    <groupId>org.apache.httpcomponents.client5</groupId>
    <artifactId>httpclient5</artifactId>
</dependency>
{code}

h3. 2. Servlet/Filter 등록 실패 시 예외 발생

{{ServletRegistrationBean}}과 {{FilterRegistrationBean}}이 등록 실패 시 경고 로그 대신
*{{IllegalStateException}}*을 던집니다. 이전 동작을 유지하려면 {{setIgnoreRegistrationFailure(true)}}를 호출하세요.

h3. 3. 기타 변경사항

* *Maven 컴파일러*: \{\{maven.compiler.source\}\}/\{\{target\}\} 대신 \{\{maven.compiler.release\}\} 사용
* *Kafka Retry Topic*: 최대 지연 초과 재시도들이 하나의 토픽으로 통합
* *Health Group 검증*: 시작 시 헬스 그룹 멤버십 유효성 검증 (비활성화: \{\{management.endpoint.health.validate\-group\-membership=false\}\})

----

h2. 새로운 기능

h3. 1. Docker Compose 지원

새로운 {{spring\-boot\-docker\-compose}} 모듈이 추가되었습니다.
Docker Compose 파일을 자동 감지하여 애플리케이션 시작 시 컨테이너를 실행하고 종료 시 중지합니다.

{code:language=groovy|theme=Emacs}
// build.gradle에 의존성 추가
dependencies {
    developmentOnly 'org.springframework.boot:spring-boot-docker-compose'
}
{code}

별도 프로퍼티 설정 없이도 {{ConnectionDetails}} 빈이 자동 생성되어 DB 접속 정보가 설정됩니다.
지원 파일명: {{compose.yaml}}, {{compose.yml}}, {{docker\-compose.yaml}}, {{docker\-compose.yml}}

주요 프로퍼티: {{spring.docker.compose.file}}, {{spring.docker.compose.lifecycle\-management}},
{{spring.docker.compose.startup.command}}, {{spring.docker.compose.shutdown.command}}

h3. 2. Testcontainers 개선

h4. {{@ServiceConnection}} 어노테이션

기존의 {{@DynamicPropertySource}} 보일러플레이트 코드를 대체합니다.

{code:language=java|theme=Emacs}
@SpringBootTest
@Testcontainers
class MyServiceTest {
    // @ServiceConnection만 붙이면 접속 정보가 자동으로 설정됨
    @Container
    @ServiceConnection
    static PostgreSQLContainer<?> postgres =
        new PostgreSQLContainer<>("postgres:15");

    @Test
    void contextLoads() {
        // PostgreSQL 접속 정보가 자동 주입됨
    }
}
{code}

h4. {{@ImportTestcontainers}} 어노테이션

컨테이너 선언을 별도 클래스로 분리하여 여러 테스트에서 재사용할 수 있습니다.

h4. 개발 시 Testcontainers 실행

Maven: {{spring\-boot:test\-run}}, Gradle: {{bootTestRun}} 태스크로 개발 중에도
Testcontainers 기반 서비스를 간편하게 시작할 수 있습니다.

h3. 3. SSL Bundles

SSL 인증서 설정을 *한 곳에서 통합 관리*할 수 있는 기능입니다.
내장 웹 서버, 데이터 서비스, {{RestTemplate}}, {{WebClient}} 등에서 일관되게 SSL을 설정합니다.

{code:language=yaml|theme=Emacs}
spring:
  ssl:
    bundle:
      pem:
        my-bundle:
          keystore:
            certificate: "classpath:cert.pem"
            private-key: "classpath:key.pem"
server:
  ssl:
    bundle: my-bundle   # 이름으로 SSL Bundle 참조
{code}

{quote}
*SSL Bundle이란?* KeyStore나 PEM 인증서를 묶어서 이름을 붙인 것입니다.
한번 정의하면 여러 곳에서 이름으로 참조하여 재사용할 수 있습니다.
{quote}

h3. 4. ConnectionDetails 추상화

외부 서비스(DB, Redis, Kafka 등)의 *접속 정보를 추상화*하는 인터페이스입니다.
Docker Compose, Testcontainers, {{application.yml}} 등 다양한 소스에서 {{ConnectionDetails}} 빈이 자동 생성됩니다.

{code:language=text|title=mermaid|collapse=true|theme=Emacs}
graph TD
    subgraph "ConnectionDetails 동작 방식"
        DC["Docker Compose"] -->|자동 생성| CD["ConnectionDetails 빈"]
        TC["Testcontainers"] -->|자동 생성| CD
        PROP["application.yml"] -->|기본 생성| CD
        CD --> AC["자동 설정<br>(DataSource 등)"]
    end
    style CD fill:#4CAF50,color:#fff
    style AC fill:#2196F3,color:#fff
{code}

{quote}
커스텀 {{ConnectionDetails}} 빈을 직접 정의하면 프로퍼티 기반 빈보다 우선 적용됩니다.
{quote}

h3. 5. Spring Authorization Server 자동 설정

{code:language=groovy|theme=Emacs}
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-authorization-server'
}
{code}

h3. 6. 로깅 및 기타 기능

* *로깅 임계값 분리*: \{\{logging.threshold.console\}\}과 \{\{logging.threshold.file\}\}로 콘솔/파일에 서로 다른 로그 레벨 설정 가능
* *GraphQL 개선*: \{\{@GraphQlExceptionHandler\}\} 지원, Spring Data 페이징/정렬 자동 설정, Connection 타입 자동 생성

----

h2. 개선사항

* *HTTP 응답 헤더 크기 제한*: \{\{server.tomcat.max\-http\-response\-header\-size\}\} / \{\{server.jetty.max\-http\-response\-header\-size\}\} (기본 8KB)
* *ActiveMQ 클라이언트 복원*: JMS 3.0 호환 클라이언트 자동 설정 복원 (브로커 내장은 미지원)
* *OTLP 트레이스*: \{\{management.otlp.tracing.\*\}\}로 OpenTelemetry 트레이스 내보내기 자동 설정
* *Wavefront*: \{\{management.wavefront.trace\-derived\-custom\-tag\-keys\}\}로 RED 메트릭 커스터마이징
* *Kafka Admin*: \{\{close\-timeout\}\}, \{\{operation\-timeout\}\}, \{\{auto\-startup\}\}, \{\{auto\-create\}\} 프로퍼티 추가
* *Jackson 2.15 처리 제한*: 스트림 읽기 제약(nesting depth 등) 도입. \{\{Jackson2ObjectMapperBuilderCustomizer\}\}로 커스터마이징 가능

----

h2. Deprecated 및 제거 항목

h3. Deprecated 항목

|| 기존 || 대체 ||
| {{spring.kafka.streams.cache\-max\-size\-buffering}} | {{spring.kafka.streams.state\-store\-cache\-max\-size}} |
| {{MongoPropertiesClientSettingsBuilderCustomizer}} | {{StandardMongoClientSettingsBuilderCustomizer}} |
| {{OAuth2ClientPropertiesRegistrationAdapter}} | {{OAuth2ClientPropertiesMapper}} |
| {{SslStoreProvider}} | SSL Bundles |
| {{git\-commit\-id\-plugin.version}} (Maven) | {{git\-commit\-id\-maven\-plugin.version}} |

h3. 제거된 항목

|| 항목 || 사유 ||
| Apache HttpClient 4 의존성 관리 | HttpClient 5로 전환 |
| 내장 ActiveMQ 브로커 | JMS 3.0 미호환 (클라이언트는 복원) |
| {{maven.compiler.source}}/{{target}} | {{maven.compiler.release}} 사용 |

----

h2. 주요 의존성 업그레이드

|| 의존성 || 버전 ||
| Spring Framework | 6.0.9 |
| Spring Security | 6.1.0 |
| Spring Data | 2023.0.0 |
| Hibernate | 6.2 |
| Jackson | 2.15 |
| Micrometer | 1.11.0 |
| Mockito | 5.3 |
| Testcontainers | 1.18 |
| Kafka | 3.4.0 |
| Kotlin | 1.8.21 |
| OpenTelemetry | 1.24.0 |

----

h2. 호환성

{code:language=text|title=mermaid|collapse=true|theme=Emacs}
graph LR
    subgraph "필수 환경"
        JAVA["Java 17+"]
        SF["Spring Framework 6.0"]
    end
    subgraph "새로운 통합"
        DOCKER["Docker Compose"]
        TC["Testcontainers 1.18"]
        SSL["SSL Bundles"]
        AUTH["Authorization Server"]
    end
    subgraph "빌드 도구"
        GRADLE["Gradle 7.5+"]
        MAVEN["Maven 3.5+"]
    end
    SB31["Spring Boot 3.1"] --> JAVA
    SB31 --> SF
    SB31 --> DOCKER
    SB31 --> TC
    SB31 --> SSL
    SB31 --> AUTH
    SB31 --> GRADLE
    SB31 --> MAVEN
    style SB31 fill:#4CAF50,color:#fff
    style DOCKER fill:#2196F3,color:#fff
    style TC fill:#2196F3,color:#fff
    style SSL fill:#FF9800,color:#fff
{code}

----

h2. 참고 자료

* [Spring Boot 3.1 공식 릴리즈 노트|https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.1-Release-Notes]
* [Spring Boot 3.0|3.0.md] (이전 버전)
* [Spring Framework 6.0|../../spring-framework/6.x/6.0.md]
* [2.x → 3.x 마이그레이션 가이드|../../migration-guides/spring-boot-2to3.md]
* [Docker Compose 지원 공식 문서|https://docs.spring.io/spring-boot/docs/3.1.x/reference/html/features.html#features.docker-compose]
* [Testcontainers 지원 공식 문서|https://docs.spring.io/spring-boot/docs/3.1.x/reference/html/features.html#features.testcontainers]
