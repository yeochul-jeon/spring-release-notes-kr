h1. Spring Framework 5.1 릴리즈 노트

Spring Framework 5.1은 2018년 9월에 릴리즈되었으며, *JDK 11을 공식 지원하는 첫 번째 버전*입니다. 로깅 개선, GraalVM 네이티브 이미지 호환성 최적화, HTTP/2 서버 지원 등 안정성과 성능에 초점을 맞추었습니다. Spring Boot 2.1의 기반 프레임워크입니다.

----

h2. 주요 변경사항

h3. 기준선(Baseline) 요구사항

|| 항목 || 버전 ||
| *Java* | 8+ (JDK 11 공식 지원) |
| *ASM* | 7.0 (JDK 11/12 바이트코드 수준 대응) |
| *CGLIB* | 3.2.8 (JDK 9+ API 활용) |
| *Reactor Core* | 3.2 (Californium) |
| *Reactor Netty* | 0.8 |

{quote}
*쉽게 말해:* JDK 11은 장기 지원(LTS) 버전으로, 5.1부터 클래스패스와 모듈 패스 모두에서 경고 없이 동작합니다.
{quote}

h3. JDK 11 공식 지원

Spring Framework 5.1은 JDK 11 환경에서 완전히 검증된 첫 번째 릴리즈입니다.

* 클래스패스(classpath)와 모듈 패스(module path) 모두에서 **경고 없는 실행** 보장
* ASM 7.0 포크를 통해 JDK 11/12 바이트코드 수준 지원
* CGLIB 포크가 JDK 9+ API를 사용하여 런타임 클래스 정의 처리

h3. Forwarded 헤더 처리 변경

{{Forwarded}} 및 {{X-Forwarded-*}} 헤더가 CORS 검사와 URI 생성 시 더 이상 개별적으로 확인되지 않습니다.

{code:language=java}
// 5.1부터는 ForwardedHeaderFilter를 명시적으로 등록해야 합니다
@Bean
FilterRegistrationBean<ForwardedHeaderFilter> forwardedHeaderFilter() {
    FilterRegistrationBean<ForwardedHeaderFilter> bean = new FilterRegistrationBean<>();
    bean.setFilter(new ForwardedHeaderFilter());
    return bean;
}
{code}

h3. URI 인코딩 강화

{{DefaultUriBuilderFactory}}가 기본적으로 더 엄격한 URI 변수 인코딩을 적용합니다. {{WebClient}}를 사용하는 기존 코드에서 동작이 달라질 수 있으므로 주의가 필요합니다.

----

h2. 새로운 기능

h3. @Profile 논리 표현식

{{@Profile}} 어노테이션에서 AND({{&}}), OR({{|}}), NOT({{!}}) 연산자를 사용한 논리 표현식을 지원합니다.

{code:language=java}
// 운영 환경이면서 클라우드 환경일 때만 활성화
@Profile("production & cloud")
@Configuration
public class CloudProdConfig {
    // 클라우드 운영 환경 전용 설정
}

// 개발 또는 테스트 환경에서 활성화
@Profile("dev | test")
@Configuration
public class DevTestConfig {
    // 개발/테스트 전용 설정
}

// 레거시 환경이 아닐 때 활성화
@Profile("!legacy")
@Configuration
public class ModernConfig {
    // 최신 환경 전용 설정
}
{code}

{quote}
*이전 방식과 비교:* 5.0까지는 여러 프로파일을 조합하려면 {{@Profile}}을 여러 개 쓰거나 커스텀 {{Condition}}을 구현해야 했습니다. 5.1부터는 하나의 어노테이션으로 간결하게 표현할 수 있습니다.
{quote}

h3. ObjectProvider 개선

{{ObjectProvider}}에 {{stream()}} 메서드와 iterable 접근이 추가되어, 같은 타입의 빈 여러 개를 편리하게 조회할 수 있습니다.

{code:language=java}
@Service
public class PluginManager {

    private final List<Plugin> plugins;

    // ObjectProvider를 통해 모든 Plugin 타입 빈을 스트림으로 조회
    public PluginManager(ObjectProvider<Plugin> pluginProvider) {
        this.plugins = pluginProvider.stream()
                .sorted(Comparator.comparing(Plugin::getOrder))
                .collect(Collectors.toList());
    }
}
{code}

또한 {{BeanFactory}}에서 프로그래밍 방식으로 {{ObjectProvider}}를 직접 얻을 수 있게 되었습니다.

h3. HTTP/2 서버 지원 (WebFlux)

Reactor Netty 0.8을 기반으로 Spring WebFlux에서 HTTP/2 서버를 지원합니다. HTTP/2는 하나의 연결에서 여러 요청을 동시에 처리하여 성능을 크게 향상시킵니다.

h3. RouterFunction DSL 빌더 개선

WebFlux의 {{RouterFunction}} 빌더를 static import 없이 사용할 수 있게 개선되었습니다. Kotlin Router DSL도 함께 개선되었습니다.

{code:language=java}
// 5.1부터 빌더 패턴으로 라우터 정의 (static import 불필요)
RouterFunction<ServerResponse> route = RouterFunctions.route()
        .GET("/users", request -> ServerResponse.ok()
                .body(userRepository.findAll(), User.class))
        .GET("/users/{id}", request -> {
            String id = request.pathVariable("id");
            return ServerResponse.ok()
                    .body(userRepository.findById(id), User.class);
        })
        .POST("/users", request -> request.bodyToMono(User.class)
                .flatMap(userRepository::save)
                .flatMap(user -> ServerResponse.created(URI.create("/users/" + user.getId()))
                        .build()))
        .build();
{code}

h3. 세분화된 MVC 예외 클래스

기존에는 대부분의 파라미터 누락 상황이 {{MissingServletRequestParameterException}}으로 처리되었지만, 5.1부터 각 상황에 맞는 전용 예외가 추가되었습니다.

|| 예외 클래스 || 발생 상황 ||
| {{MissingRequestHeaderException}} | 필수 요청 헤더 누락 |
| {{MissingRequestCookieException}} | 필수 쿠키 누락 |
| {{MissingPathVariableException}} | 경로 변수 누락 |

{code:language=java}
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(MissingRequestHeaderException.class)
    public ResponseEntity<String> handleMissingHeader(MissingRequestHeaderException ex) {
        // 헤더별로 세분화된 에러 처리 가능
        return ResponseEntity.badRequest()
                .body("필수 헤더가 누락되었습니다: " + ex.getHeaderName());
    }

    @ExceptionHandler(MissingRequestCookieException.class)
    public ResponseEntity<String> handleMissingCookie(MissingRequestCookieException ex) {
        return ResponseEntity.badRequest()
                .body("필수 쿠키가 누락되었습니다: " + ex.getCookieName());
    }
}
{code}

h3. 컨트롤러 인터페이스 매핑

파라미터 어노테이션이 인터페이스에서도 감지되어, *인터페이스 기반 컨트롤러 계약(Contract)* 을 정의할 수 있게 되었습니다.

{code:language=java}
// 인터페이스에 매핑 정보를 정의
public interface UserApi {

    @GetMapping("/users/{id}")
    UserDto getUser(@PathVariable("id") Long id);

    @PostMapping("/users")
    UserDto createUser(@RequestBody CreateUserRequest request);
}

// 구현체에서는 비즈니스 로직에만 집중
@RestController
public class UserController implements UserApi {

    @Override
    public UserDto getUser(Long id) {
        // 매핑 어노테이션 없이도 인터페이스의 매핑 정보가 적용됨
        return userService.findById(id);
    }

    @Override
    public UserDto createUser(CreateUserRequest request) {
        return userService.create(request);
    }
}
{code}

h3. SameSite=Lax 세션 쿠키

WebFlux에서 세션 쿠키에 {{SameSite=Lax}} 속성이 기본 적용됩니다. 이는 외부 사이트에서 전송되는 쿠키를 제한하여 *CSRF(사이트 간 요청 위조) 공격을 방어*합니다.

----

h2. 개선사항

h3. 로깅 개선

5.1에서 로깅 체계가 전면 개선되었습니다.

|| 로그 레벨 || 용도 ||
| *INFO* | 불필요한 노이즈를 줄여 핵심 정보만 출력 |
| *DEBUG* | 사람이 읽기 편한 형태로 요약 정보 제공 |
| *TRACE* | 상세한 디버깅 정보 제공 |

{{DispatcherServlet}}에 {{enableLoggingRequestDetails}} 옵션이 추가되어, 민감한 요청 데이터의 로깅 여부를 제어할 수 있습니다.

{code:language=java}
// application.properties에서 설정
spring.mvc.log-request-details=true
{code}

WebFlux에서도 HTTP 요청과 WebSocket 세션에 대한 상관(correlated) 로그 메시지가 지원됩니다.

h3. 성능 최적화

|| 영역 || 개선 내용 ||
| 타입/어노테이션 분석 | 핵심 인트로스펙션 알고리즘 간소화 |
| 시작 시간 | 빈 정의 처리 최적화로 기동 시간 단축 |
| GC 부담 | 가비지 컬렉션 압력 감소 |
| GraalVM | 네이티브 이미지(Substrate VM) 호환성 미세 조정 |

h3. Hibernate 5.3 지원

* Hibernate의 새로운 SPI(Service Provider Interface)와 빈 컨테이너 통합
* `LocalSessionFactoryBean`과 `HibernateTransactionManager`가 JPA 상호작용 지원 (네이티브 Hibernate와 JPA를 트랜잭션 내에서 혼용 가능)
* **읽기 전용 트랜잭션 최적화**: `Session.setDefaultReadOnly(true)` 호출로 엔티티 스냅샷을 유지하지 않아 메모리 절감
* SAP HANA가 `JpaVendorAdapter` 플랫폼으로 추가

h3. 기타 개선사항

* **Brotli 압축 리소스**: 정적 리소스 서빙 시 GZip과 함께 Brotli 사전 인코딩 리소스 지원
* **PUT/PATCH/DELETE 파라미터**: Servlet 요청 파라미터를 이 HTTP 메서드들에서도 접근 가능
* **Protobuf 직렬화**: WebFlux에서 메시지 스트리밍과 함께 Protobuf 직렬화 지원
* **WebSocket 세션 속성**: WebSocket 세션에서 속성(attribute) 지원
* **테스트**: `WebTestClient`에 Hamcrest 및 XML 어설션 통합

----

h2. 폐기(Deprecated) 및 제거(Removed) 항목

h3. 주의가 필요한 변경

|| 항목 || 설명 ||
| 중첩 설정 클래스 감지 | 최상위 {{@Configuration}} 또는 {{@Component}} 클래스에서만 감지 (단순 {{@Import}}/{{@ComponentScan}}에서는 미감지) |
| {{produces}} 조건과 에러 응답 | {{@RequestMapping}}의 {{produces}} 조건이 에러 응답의 Content-Type에 영향을 주지 않음 |
| Multipart 파라미터 집계 | Apache Commons FileUpload 사용 시 Servlet 3.1 스펙에 따라 multipart와 query 파라미터를 함께 집계 |
| {{DefaultUriBuilderFactory}} | 기본 URI 변수 인코딩이 더 엄격해짐 |

----

h2. 호환성

{code:language=text|title=mermaid|collapse=true}
graph TD
    SF51[Spring Framework 5.1] --> JDK8[JDK 8+]
    SF51 --> JDK11[JDK 11 공식 지원]
    SF51 --> SB21[Spring Boot 2.1]

    SF51 --> RC32[Reactor Core 3.2]
    SF51 --> RN08[Reactor Netty 0.8]
    SF51 --> HB53[Hibernate 5.3]

    JDK11 --> ASM7[ASM 7.0]
    JDK11 --> CGLIB[CGLIB 3.2.8]

    SB21 --> SD21[Spring Data 2.1]
    SB21 --> SS51[Spring Security 5.1]
{code}

h3. Spring 포트폴리오 호환

* Spring Boot 2.1
* Spring Security 5.1
* Spring Data 2.1 (Lovelace)
* Reactor Californium (Core 3.2 / Netty 0.8)

----

h2. 참고 자료

* [Spring Framework 5.1 Release Notes (GitHub Wiki)](https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-5.1-Release-Notes)
* [What's New in Spring Framework 5.x (GitHub Wiki)](https://github.com/spring-projects/spring-framework/wiki/What's-New-in-Spring-Framework-5.x)
* [Spring Blog - Spring Framework 5.1 goes GA](https://spring.io/blog/2018/09/21/spring-framework-5-1-goes-ga)
* [Spring Boot 2.1 Release Notes (GitHub Wiki)](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.1-Release-Notes)
