h1. Spring Framework 6.1 릴리즈 노트

Spring Framework 6.1은 2023년 11월에 릴리즈된 마이너 버전으로, {{RestClient}}, {{JdbcClient}} 등 새로운 클라이언트 API를 도입하고 JDK 21의 *가상 스레드(Virtual Threads)* 를 공식 지원합니다. Spring Boot 3.2의 기반 프레임워크이며, 개발 생산성과 런타임 효율성을 크게 향상시킨 버전입니다.

----

h2. 주요 변경사항

h3. 기준선(Baseline)

|| 항목 || 요구사항 ||
| *Java* | 17+ (JDK 21 공식 지원) |
| *Jakarta EE* | 9+ |
| *SnakeYAML* | 2.0 |
| *Jackson* | 2.14+ |
| *Kotlin Coroutines* | 1.7+ |

h3. RestClient - 새로운 동기 HTTP 클라이언트

{{RestClient}}는 기존 {{RestTemplate}}을 대체하기 위해 도입된 *동기(synchronous) HTTP 클라이언트*입니다. {{WebClient}}와 유사한 *플루언트(fluent) API*를 제공하면서도, {{RestTemplate}}의 인프라를 공유합니다.

{quote}
*플루언트 API란?* 메서드 체이닝({{.method1().method2().method3()}})으로 코드를 마치 문장처럼 읽을 수 있게 만드는 설계 방식입니다.
{quote}

{code:language=java}
// RestClient 생성
RestClient restClient = RestClient.builder()
    .baseUrl("https://api.example.com")
    .defaultHeader("Authorization", "Bearer token123")
    .build();

// GET 요청 - 단일 객체 조회
User user = restClient.get()
    .uri("/users/{id}", 1)
    .retrieve()
    .body(User.class);

// POST 요청 - 객체 생성
User newUser = restClient.post()
    .uri("/users")
    .contentType(MediaType.APPLICATION_JSON)
    .body(new User("홍길동", "hong@example.com"))
    .retrieve()
    .body(User.class);
{code}

{code:language=text|title=mermaid|collapse=true}
graph LR
    RT["RestTemplate<br/>(2009, Spring 3.0)<br/>동기 · 콜백 방식"] --> WC["WebClient<br/>(2017, Spring 5.0)<br/>비동기 · 리액티브"]
    WC --> RC["RestClient<br/>(2023, Spring 6.1)<br/>동기 · 플루언트 API"]

    style RT fill:#ffcccc,stroke:#cc0000
    style WC fill:#cce5ff,stroke:#0066cc
    style RC fill:#ccffcc,stroke:#009900
{code}

{quote}
*어떤 것을 사용해야 할까?*

* 새 프로젝트의 동기 HTTP 호출 → **RestClient** 권장
* 리액티브/비동기 처리가 필요한 경우 → **WebClient** 사용
* 기존 `RestTemplate` 코드 → 점진적으로 `RestClient`로 마이그레이션 권장
{quote}

h3. JdbcClient - 통합 JDBC 클라이언트

{{JdbcClient}}는 {{JdbcTemplate}}과 {{NamedParameterJdbcTemplate}}을 하나로 통합한 *플루언트 API* 기반의 JDBC 클라이언트입니다.

{code:language=java}
// JdbcClient 생성 (JdbcTemplate 또는 DataSource로부터)
JdbcClient jdbcClient = JdbcClient.create(dataSource);

// 단일 조회 - 위치 기반 파라미터
Optional<User> user = jdbcClient.sql("SELECT * FROM users WHERE id = ?")
    .param(1)
    .query(User.class)
    .optional();

// 목록 조회 - 이름 기반 파라미터
List<User> users = jdbcClient.sql("SELECT * FROM users WHERE name LIKE :name")
    .param("name", "%홍%")
    .query(User.class)
    .list();

// INSERT 실행
int count = jdbcClient.sql("INSERT INTO users (name, email) VALUES (:name, :email)")
    .param("name", "홍길동")
    .param("email", "hong@example.com")
    .update();
{code}

h3. 가상 스레드(Virtual Threads) 지원

JDK 21에서 정식 도입된 가상 스레드를 Spring에서 활용할 수 있습니다. 가상 스레드는 OS 스레드보다 훨씬 가볍고, 수십만 개를 동시에 생성할 수 있어 높은 동시성 처리에 유리합니다.

{code:language=java}
@Configuration
@EnableAsync
public class AsyncConfig {

    // 가상 스레드 전용 TaskExecutor
    @Bean
    public AsyncTaskExecutor applicationTaskExecutor() {
        SimpleAsyncTaskExecutor executor = new SimpleAsyncTaskExecutor();
        executor.setVirtualThreads(true);  // 가상 스레드 모드 활성화
        return executor;
    }
}
{code}

주요 지원 항목:

* **`VirtualThreadTaskExecutor`** - 가상 스레드 전용 TaskExecutor
* **`SimpleAsyncTaskExecutor`** - `setVirtualThreads(true)`로 가상 스레드 모드 전환
* **`SimpleAsyncTaskScheduler`** - 스케줄링 작업에 가상 스레드 적용

h3. Project CRaC 통합 - JVM 체크포인트/복원

Project CRaC(Coordinated Restore at Checkpoint)는 JVM의 상태를 스냅샷으로 저장(체크포인트)하고, 이후 빠르게 복원하는 기술입니다. 애플리케이션 시작 시간을 *밀리초 단위*로 줄일 수 있습니다.

{code:language=bash}
# 컨텍스트 새로고침(refresh) 시점에 체크포인트 생성
java -Dspring.context.checkpoint=onRefresh -jar myapp.jar

# 체크포인트 생성 후 즉시 종료 (배포 준비용)
java -Dspring.context.exit=onRefresh -jar myapp.jar
{code}

----

h2. 새로운 기능

h3. HTTP 인터페이스 클라이언트 확장

{{RestClient}}와 {{RestTemplate}}을 위한 내장 어댑터가 추가되었습니다. 기존에는 {{WebClient}}만 지원했지만, 이제 동기 클라이언트에서도 선언적 HTTP 인터페이스를 사용할 수 있습니다.

{code:language=java}
// HTTP 인터페이스 정의
public interface UserApi {
    @GetExchange("/users/{id}")
    User getUser(@PathVariable int id);

    @PostExchange("/users")
    User createUser(@RequestBody User user);
}

// RestClient 기반 프록시 생성
RestClient restClient = RestClient.builder()
    .baseUrl("https://api.example.com")
    .build();

RestClientAdapter adapter = RestClientAdapter.create(restClient);
HttpServiceProxyFactory factory = HttpServiceProxyFactory.builderFor(adapter).build();

UserApi userApi = factory.createClient(UserApi.class);
User user = userApi.getUser(1); // 선언적 호출
{code}

h3. JMS 관찰 가능성(Observability)

{{JmsTemplate}}으로 메시지를 발행하거나, {{@JmsListener}}로 메시지를 수신할 때 Micrometer 기반 관찰(Observation)이 자동으로 생성됩니다. 이를 통해 메시지 처리 성능을 모니터링하고 분산 추적(distributed tracing)에 활용할 수 있습니다.

h3. Graceful Shutdown - 일시 중지/재개 기능

{{ThreadPoolTaskExecutor}}와 {{ThreadPoolTaskScheduler}}에 *일시 중지(pause)* 와 *재개(resume)* 기능이 추가되었습니다. 그레이스풀 셧다운 중에는 새로운 태스크 제출이 거부되어, 진행 중인 작업이 안전하게 완료된 후 종료됩니다.

h3. ClientHttpRequestFactory 신규 구현체

{{RestTemplate}}과 {{RestClient}}에서 사용할 수 있는 새로운 HTTP 클라이언트 엔진이 추가되었습니다.

|| 구현체 || 기반 기술 || 특징 ||
| {{JdkClientHttpRequestFactory}} | JDK HttpClient | JDK 내장, 추가 의존성 불필요 |
| {{ReactorNettyClientRequestFactory}} | Reactor Netty | 비동기 지원, 커넥션 풀 관리 |
| {{JettyClientHttpRequestFactory}} | Jetty HttpClient | Jetty 기반 프로젝트에 최적 |

h3. 메서드 유효성 검증 내장

Controller에서 {{@Validated}} 없이도 {{@Constraint}} 어노테이션(예: {{@NotBlank}}, {{@Min}})이 자동으로 유효성 검증됩니다.

{code:language=java}
@RestController
@RequestMapping("/users")
public class UserController {

    // @Validated 없이도 @Min, @NotBlank 검증이 동작합니다
    @GetMapping("/{id}")
    public User getUser(@PathVariable @Min(1) Long id) {
        return userService.findById(id);
    }

    @PostMapping
    public User createUser(@RequestBody @Valid UserRequest request) {
        return userService.create(request);
    }
}
{code}

h3. 리액티브 @Scheduled 메서드

{{@Scheduled}} 메서드가 {{Mono}}나 {{Flux}}를 반환할 수 있게 되었으며, Kotlin 코루틴도 지원됩니다.

h3. 리액티브 캐싱 (@Cacheable)

{{@Cacheable}} 메서드가 {{Mono}}와 {{Flux}} 반환 타입을 자동 감지하여 비동기 방식으로 캐싱합니다.

h3. 기타 신규 기능

* **SpEL 개선**: `MethodHandle`을 SpEL 함수로 등록 가능
* **생성자 바인딩**: `@BindParam` 커스텀 바인딩, 중첩 객체 지원
* **`@HttpExchange`**: 서버 측에서도 `@RequestMapping` 대안으로 사용 가능
* **Spring AOP Kotlin 코루틴 지원**

----

h2. 개선사항

h3. 성능

|| 영역 || 개선 내용 ||
| JDBC {{setNull}} | PostgreSQL/MS SQL Server에서 {{getParameterType}} 호출을 생략하여 성능 향상 |
| 요청 본문 버퍼링 | {{RestTemplate}} 요청 본문 버퍼링 기본 비활성화로 메모리 절감 |
| 네이티브 이미지 로깅 | 상세(verbose) 로깅 기본 비활성화 |

h3. 테스트 프레임워크

* **컨텍스트 실패 임계값**: 반복 실패하는 컨텍스트 로드를 방지 (기본값: 1회)
* **`@TestPropertySource` 와일드카드**: 리소스 패턴/와일드카드 지원
* **비동기 이벤트 기록**: `@RecordApplicationEvents`로 크로스 스레드 이벤트 검증 가능
* **`MockRestServiceServer`**: 새로운 `RestClient` 지원
* **`JdbcTestUtils`**: `JdbcClient`를 인자로 받는 오버로드 메서드 추가
* **AOT 테스트**: 빌드 시 오류 기본 감지, `@DisabledInAotMode` 어노테이션

h3. 기타 개선

* `ContextPropagatingTaskDecorator`로 `@Async`/`@EventListener` 컨텍스트 전파
* `TransactionExecutionListener` — 트랜잭션 전/후 콜백 계약 추가
* R2DBC에서 `BeanPropertyRowMapper`, `DataClassRowMapper` 지원

----

h2. 폐기(Deprecated) 및 제거(Removed) 항목

h3. 폐기 예고

|| 항목 || 대안 ||
| {{RestTemplate}} | 공식 문서에서 {{RestClient}} 사용을 권장 |
| {{DispatcherHandler.throwExceptionIfNoHandlerFound}} | 기본값이 {{true}}로 변경, 속성 자체 폐기 |
| {{AutowireCapableBeanFactory.createBean(Class, int, boolean)}} | 관례 기반 메서드 사용 |

h3. 제거 및 동작 변경

|| 항목 || 설명 ||
| {{LocalVariableTableParameterNameDiscoverer}} | 제거됨. {{-parameters}} 컴파일러 플래그 필수 |
| URL 해석 방식 | {{URL}} 생성자 대신 {{URI}}를 통한 일관된 해석 |
| WebSocket SpEL selector | 보안상 기본 비활성화, 명시적 활성화 필요 |
| {{Jackson ParameterNamesModule}} | {{Jackson2ObjectMapperBuilder}}에서 자동 등록 |

{quote}
*주의:* {{-parameters}} 컴파일러 플래그를 추가하지 않으면 매개변수 이름 기반 주입이나 바인딩이 동작하지 않습니다. Gradle: {{tasks.withType(JavaCompile) \{ options.compilerArgs.add("-parameters") \}}}, Maven: {{<compilerArgs><arg>-parameters</arg></compilerArgs>}} 설정을 확인하세요.
{quote}

----

h2. 호환성

{code:language=text|title=mermaid|collapse=true}
graph TD
    SF61[Spring Framework 6.1] --> JDK17[JDK 17+]
    SF61 --> JDK21[JDK 21 공식 지원]
    SF61 --> JEE9[Jakarta EE 9+]
    SF61 --> SB32[Spring Boot 3.2]

    JEE9 --> S50[Servlet 5.0+]
    S50 --> TC10[Tomcat 10+]
    S50 --> JT11[Jetty 11+]

    SF61 --> VT[가상 스레드]
    VT --> JDK21

    SF61 --> CRaC[Project CRaC]
{code}

h3. Spring 포트폴리오 호환

* **Spring Boot** 3.2.x
* **Spring Security** 6.2.x
* **Spring Data** 2023.1 (2023.1.x)
* **Spring Cloud** 2023.0.x

----

h2. 참고 자료

* [Spring Framework 6.1 Release Notes (GitHub Wiki)](https://github.com/spring-projects/spring-framework/wiki/Spring-Framework-6.1-Release-Notes)
* [What's New in Spring Framework 6.x (GitHub Wiki)](https://github.com/spring-projects/spring-framework/wiki/What's-New-in-Spring-Framework-6.x)
* [Spring Blog - Spring Framework 6.1 GA](https://spring.io/blog/2023/11/16/spring-framework-6-1-goes-ga)
* [Spring Boot 3.2 Release Notes](https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.2-Release-Notes)
* [Spring Framework 6.0 릴리즈 노트](6.0.md)
